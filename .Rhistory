t_transitions <- theme_box(t_transitions)
t_transitions <- width(t_transitions, 1, 1.4)
t_transitions <- width(t_transitions, 2, 1.4)
t_transitions <- width(t_transitions, 3, 2.4)
t_transitions <- width(t_transitions, 4, 1.3)
t_transitions <- bg(t_transitions, i = c(1, 39, 46, 53, 76, 85, 91, 103, 110), bg = "#DDDDDD", part = "body")
t_transitions <- bold(t_transitions, i = c(1, 39, 46, 53, 76, 85, 91, 103, 110))
t_transitions <- bg(t_transitions, bg = "#EAEAEA", part = "header")
#DALY CALCULATIONS
dt.daly <- rbind(dt_daly_params)
dt.daly[ , basecase_formatted := ifelse(format == "dollar",  dollar(`Base case`, largest_with_cents = 1e2),
ifelse(format == "percent", paste0(signif(`Base case`,3)*100,"%"),
signif(`Base case`,3)))]
dt.daly[ , Low := ifelse(format == "dollar",  dollar(Low, largest_with_cents = 1e2),
ifelse(format == "percent", paste0(signif(Low,3)*100,"%"),
signif(Low,3)))]
dt.daly[ , High := ifelse(format == "dollar",  dollar(High, largest_with_cents = 1e2),
ifelse(format == "percent", paste0(signif(High,3)*100,"%"),
signif(High,3)))]
dt.daly[ , Value := ifelse(is.na(Low), basecase_formatted, paste0(basecase_formatted, " (", Low, "–", High, ")"))]
dt.daly <- dt.daly[ , c("Category", "Description", "Value", "Source")]
#Additional parameters for calculation disability-adjusteed life years (DALYs)
dt.daly <- as_grouped_data(dt.daly, groups = c("Category"))
t_daly <- as_flextable(dt.daly)
#t_daly <- set_header_labels(t_daly, Description = "")
t_daly <- compose(t_daly, i = ~ !is.na(Category), j = "Description",
value = as_paragraph(as_chunk(Category)))
t_daly <- align(t_daly, align = "left", part = "all")
t_daly <- set_header_labels(t_daly, values = list(Value = "Value (range)"))
t_daly <- fontsize(t_daly, size = 10, part = "all")
t_daly <- theme_box(t_daly)
t_daly <- width(t_daly, 1, 2.4)
t_daly <- width(t_daly, 2, 2.4)
t_daly <- width(t_daly, 3, 1.2)
t_daly <- bg(t_daly, i = c(1, 7, 10, 13, 17, 31, 49), bg = "#DDDDDD", part = "body")
t_daly <- bold(t_daly, i = c(1, 7, 10, 13, 17, 31, 49), part = "body")
t_daly <- bg(t_daly, bg = "#EAEAEA", part = "header")
t_daly <- font(t_daly, fontname = "Times", part = "all")
t_daly <- footnote(t_daly, i=1, part="body",ref_symbols = "1",
value = as_paragraph("Sepsis: Inpatient mortality weight applied to the increased duration of hospitalization (parameter in Table S2). Probability of post-hospitalization sequelae appled to patients surviving hospitalization."))
t_daly <- footnote(t_daly, i=17, part="body",ref_symbols = "2",
value = as_paragraph("HCV: Assumed no disability from subclinical acute HCV. Assumed some disability from acute HCV on treatment due to side effects, calculated from the difference between the disability weights used for treatment at other disease stages."))
t_daly <- footnote(t_daly, i=31, part="body",ref_symbols = "3",
value = as_paragraph("HBV: Assumed no disability for acute, immune tolerant, and inactive carrier disease states. We assumed the disability in the chronic HBeAg- HBV would be half that of immune reactive when not on AVT and would be equal to that of immune reactive when on AVT."))
t_daly <- footnote(t_daly, i=49, part="body",ref_symbols = "4",
value = as_paragraph("HIV: We assumed no disability for undetected (subclinical) HIV. For undetected AIDS, we assumed patients experience symptoms that are less severe than average (otherwise they would be diagnosed), and we calculated their disability weight as 50% the typical disability weight for symptomatic pre-HIV AIDS. For patients initiating AVT with pre-AIDS HIV, we assume 50% had no symptoms and 50% have symptomatic HIV that typically becomes asymptomatic about 6 months after AVT initiation. We therefore calculated the average disability weight for the first year of HIV treatment as 75% of the 'receiving treatment' weight and 25% of the 'symptomatic HIV' weight. For patients initiating AVT with AIDS, we calculated their first-year disutility as 50% that of untreated AIDS and 50% that of a typical patient on treatment. We calculated their second-year disutility as 25% that of untreated AIDS and 75% that of a typical patient on treatment. For those with residual disability from their AIDS-related illness, we assumed their disutility remained the same for subsequent years on treatment."))
#
# t_daly <- colformat_md(t_daly, j=4,
#                        pandoc_args=c('--csl', 'apa.csl'))
#Tornado diagram
bc_net_savings <- unlist(dt_bc_outcomes$net_savings)
dt_univ[ , name_range := paste0(Param_disp, "\n", Low, " – ", High)]
dt_univ[ , name_range := factor(name_range, levels = rev(unique(name_range)))]
#dt_univ[ , blank := pmin(net_savings_low, net_savings_high)]
dt_univ_plt <- rbind(setorder(dt_univ[abs_net_savings_range>5e5], -abs_net_savings_range))
dt_univ_plt[, x:= nrow(dt_univ_plt):1]
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings)+
geom_hline(yintercept = 0, alpha = 0.5, color = "red")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=.8, y=bc_net_savings+1.75e6, label=paste0("Basecase:", dollar(bc_net_savings)), size = 3.5)
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
# #Cases&costs by AE
# dt_bc_outcomes
dt_outcome_quants <- dt_psa_outcomes[ , lapply(.SD,
function(x)
quantile(x, probs = c(0.025, 0.975)))]
#
# dt_case_cost_plot <- data.table(
#   ae_abbrev = rep(ae_abbrevs, 2),
#   outcome = rep(c("Cases reduced",
#                   "Healthcare spending reduced"), each = 7),
#   value = numeric(),
#   lb = numeric(),
#   ub = numeric()
# )
# for (ae in ae_abbrevs){
#   dt_case_cost_plot[ae_abbrev == ae & outcome == "Cases reduced", value:= dt_bc_outcomes[1, get(paste0(ae, ".cases_reduced"))]]
#   dt_case_cost_plot[ae_abbrev == ae & outcome == "Cases reduced", lb:= dt_outcome_quants[1, get(paste0(ae, ".cases_reduced"))]]
#   dt_case_cost_plot[ae_abbrev == ae & outcome == "Cases reduced", ub:= dt_outcome_quants[2, get(paste0(ae, ".cases_reduced"))]]
#   dt_case_cost_plot[ae_abbrev == ae & outcome == "Healthcare spending reduced", value:= dt_bc_outcomes[1, get(paste0(ae, ".burden_reduced"))]]
#   dt_case_cost_plot[ae_abbrev == ae & outcome == "Healthcare spending reduced", lb:= dt_outcome_quants[1, get(paste0(ae, ".burden_reduced"))]]
#   dt_case_cost_plot[ae_abbrev == ae & outcome == "Healthcare spending reduced", ub:= dt_outcome_quants[2, get(paste0(ae, ".burden_reduced"))]]
# }
#
# max_case_reduct <- max(dt_case_cost_plot[outcome=="Cases reduced"]$ub)
# max_spend_reduct <- max(dt_case_cost_plot[outcome=="Healthcare spending reduced"]$ub)
# dt_case_cost_plot[ , val.perc := ifelse(outcome == "Cases reduced", value/max_case_reduct, value/max_spend_reduct)]
# dt_case_cost_plot[ , lb.perc := ifelse(outcome == "Cases reduced", lb/max_case_reduct, lb/max_spend_reduct)]
# dt_case_cost_plot[ , ub.perc := ifelse(outcome == "Cases reduced", ub/max_case_reduct, ub/max_spend_reduct)]
#
# ggplot(dt_case_cost_plot, aes(x = reorder(ae_abbrev, -value), y = value))+
#   geom_bar(position="dodge", stat="identity")+
#   geom_linerange(aes(ymin = lb, ymax = ub))+
#   facet_wrap(.~outcome, nrow = 2, scales = "free_y", strip.position = "left")+
#   ylab(NULL)+xlab("Adverse event")+
#   theme(strip.background = element_blank(), strip.placement = "outside")
#Net budget impact
dt_net_impact <- data.table(
outcome = factor(c("PI cost",
"Healthcare\nsavings",
"Net\nimpact"), levels = c("PI cost",
"Healthcare\nsavings",
"Net\nimpact")),
value = c(dt_bc_outcomes$prt_cost,
-1*dt_bc_outcomes$all_ae.burden_reduced,
-1*dt_bc_outcomes$net_savings),
lb = c(dt_outcome_quants[1,]$prt_cost,
-1*dt_outcome_quants[1,]$all_ae.burden_reduced,
-1*dt_outcome_quants[1,]$net_savings),
ub = c(dt_outcome_quants[2,]$prt_cost,
-1*dt_outcome_quants[2,]$all_ae.burden_reduced,
-1*dt_outcome_quants[2,]$net_savings)
)
ggplot(dt_net_impact, aes(x=outcome, y = value))+
geom_bar(position="dodge", stat="identity", width = 0.5, fill="grey")+
geom_errorbar(aes(ymin=lb, ymax=ub), width=0.2)+
ylab("Net present cost")+xlab(NULL)+
scale_y_continuous(labels = label_dollar())+
geom_hline(yintercept = 0)
ggsave("figs/net_impact.png",
width=3,
height = 2.5,
units="in")
#PSA scatter
dt_psa_outcomes[, cost_saving := ifelse(net_savings>=0, "Cost saving", "Not cost saving")]
dt_psa_outcomes[, ICER:= -1*net_savings/all_ae.DALY_reduced]
ggplot(dt_psa_outcomes, aes(x=all_ae.DALY_reduced, y=-1*net_savings))+
geom_point(aes(color=cost_saving), alpha=0.5)+
geom_hline(yintercept=0, color="grey")+
scale_y_continuous(labels = label_dollar(), name="Net incremental healthcare cost")+
scale_x_continuous(labels = label_comma(), name="Incremental DALYs averted", limits = c(0, 170000))+
#geom_abline(slope=100)+
annotate("text",
label=paste0("WBPR was cost-saving\nin ",
percent(dt_psa_outcomes[net_savings>0, .N/nrow(dt_psa_outcomes)]),
" of iterations"),
x=120000, y = -1e6, color="forestgreen")+
annotate("text",
label=paste0("WBPR never cost more\nthan ",
dt_psa_outcomes[, dollar(ceiling(max(ICER)))],
" per DALY"),
x=120000, y = 1e6, color="dodgerblue")+
theme(legend.position = "None")+
scale_color_manual(values=c("forestgreen", "dodgerblue"))
# annotate("label",
#          label=paste0("WBPR cost <$100/DALY in ",
#                       percent(dt_psa_outcomes[, sum(-1*net_savings/all_ae.DALY_reduced<100)/.N]),
#                       " of iterations"),
#          x=90000, y = 5.5e6)
ggsave("figs/cea_scatter.png",
width=6.5,
height = 4,
units="in")
t1 <- flextable(dt_results[c(1:6, 9, 12), c(1, 3:9)])
t1 <- align(t1, align = "left", part = "all")
t1 <- set_header_labels(t1, values = list(Value_dist = "Value (range); distribution"))
t1 <- fontsize(t1, size = 10, part = "all")
t1 <- font(t1, fontname = "Times", part = "all")
t1 <- theme_box(t1)
t1 <- width(t1, 1, 1.3)
t1 <- width(t1, 2:8, 1.1)
t1 <- bg(t1, bg = "#EAEAEA", part = "header")
dt.t_calcs <- data.table(read_excel("../data/Ghana_hea_parameters.xlsx", sheet = "Microcost_eqns"))
t_calcs <- flextable(dt.t_calcs)
t_calcs <- fontsize(t_calcs, size = 10, part = "all")
t_calcs <- font(t_calcs, fontname = "Times", part = "all")
t_calcs <- theme_box(t_calcs)
t_calcs <- width(t_calcs, 1, 2.1)
t_calcs <- width(t_calcs, 2, 4.4)
t_calcs <- bg(t_calcs, bg = "#EAEAEA", part = "header")
dt_chronic_disease_states <- fread("../results/chronic_costs_by_disease_state.csv")
dt_chronic_state_lookup <- data.table(read_excel("../data/Ghana_hea_parameters.xlsx", sheet ="chronic_state_lookup"))
dt_chronic_disease_states <- dt_chronic_state_lookup[,c("Disease","Disease state", "state_disp")][dt_chronic_disease_states,
on = c("Disease", "Disease state")]
dt_chronic_disease_states[ ,`Disease state` := state_disp]
dt_chronic_disease_states[ ,state_disp := NULL]
dt_chronic_disease_states <- melt(dt_chronic_disease_states, id.vars = 1:4)
#dt_chronic_disease_states <-
dt_chronic_disease_states <- dcast(dt_chronic_disease_states, Disease+`Disease state`+`Annual cost` ~  variable+Cohort, sep=", ")
cols <- colnames(dt_chronic_disease_states)[3:7]
dt_chronic_disease_states[ , (cols) := lapply(.SD, "dollar"), .SDcols=3:7]
dt_chronic_disease_states <- as_grouped_data(dt_chronic_disease_states, groups = c("Disease"))
t_chron_disease_states <- as_flextable(dt_chronic_disease_states)
t_chron_disease_states <- compose(t_chron_disease_states, i = ~ !is.na(Disease), j = "Disease state",
value = as_paragraph(as_chunk(Disease)))
t_chron_disease_states <- align(t_chron_disease_states, align = "left", part = "all")
t_chron_disease_states <- fontsize(t_chron_disease_states, size = 10, part = "all")
t_chron_disease_states <- font(t_chron_disease_states, fontname = "Times", part = "all")
t_chron_disease_states <- theme_box(t_chron_disease_states)
#t_chron_disease_states <- width(t_chron_disease_states, 1, 2.1)
# t_chron_disease_states <- width(t_chron_disease_states, 2, 4.4)
t_chron_disease_states <- bg(t_chron_disease_states, bg = "#EAEAEA", part = "header")
t_chron_disease_states <- width(t_chron_disease_states, 1, 1.7)
t_chron_disease_states <- width(t_chron_disease_states, 2, 0.8)
t_chron_disease_states <- width(t_chron_disease_states, 3:6, 1)
t_chron_disease_states <- bg(t_chron_disease_states, i = c(1, 21, 37), bg = "#DDDDDD", part = "body")
disease_state_key_hiv <- dt_chronic_state_lookup[Disease == "HIV", paste0(`Disease state`, ", ", state_disp, collapse = "; ")]
disease_state_key_hbv <- dt_chronic_state_lookup[Disease == "HBV", paste0(`Disease state`, ", ", state_disp, collapse = "; ")]
disease_state_key_hcv <- dt_chronic_state_lookup[Disease == "HCV", paste0(`Disease state`, ", ", state_disp, collapse = "; ")]
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings)+
geom_hline(yintercept = 0, alpha = 0.5, color = "red")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=.8, y=bc_net_savings+1.75e6, label=paste0("Basecase:", dollar(bc_net_savings)), size = 3.5)
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings)+
geom_hline(yintercept = 0, alpha = 0.5, color = "red")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=.8, y=bc_net_savings+2.2e6, label=paste0("Basecase:", dollar(bc_net_savings)), size = 3.5)
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings)+
geom_hline(yintercept = 0, alpha = 0.5, color = "red")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=.8, y=bc_net_savings+2.6e6, label=paste0("Basecase:", dollar(bc_net_savings)), size = 3.5)
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings)+
geom_hline(yintercept = 0, alpha = 0.5, color = "red")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
limits = c(-5e6, 7e6)
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=.8, y=bc_net_savings+2.6e6, label=paste0("Basecase:", dollar(bc_net_savings)), size = 3.5)
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings)+
geom_hline(yintercept = 0, alpha = 0.5, color = "red")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
limits = c(-5e6, 6e6)
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=.8, y=bc_net_savings+2.6e6, label=paste0("Basecase:", dollar(bc_net_savings)), size = 3.5)
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings)+
geom_hline(yintercept = 0, alpha = 0.5, color = "red")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=.8, y=bc_net_savings+2.6e6, label=paste0("Basecase:\n", dollar(bc_net_savings)), size = 3.5)
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings)+
geom_hline(yintercept = 0, alpha = 0.5, color = "red")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=1.6, y=bc_net_savings+1.6e6, label=paste0("Basecase:\n", dollar(bc_net_savings)), size = 3.5)
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings, color="red")+
geom_hline(yintercept = 0, alpha = 0.5, color = "black")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=1.6, y=bc_net_savings+1.6e6, label=paste0("Basecase:\n", dollar(bc_net_savings)),
size = 3.5, color="red")
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings, color="grey")+
geom_hline(yintercept = 0, alpha = 0.5, color = "black")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=1.6, y=bc_net_savings+1.6e6, label=paste0("Basecase:\n", dollar(bc_net_savings)),
size = 3.5, color="darkgrey")
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings, color="black")+
geom_hline(yintercept = 0, alpha = 0.5, color = "black", linetype="dashed")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=1.6, y=bc_net_savings+1.6e6, label=paste0("Basecase:\n", dollar(bc_net_savings)),
size = 3.5, color="darkgrey")
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings, color="black")+
geom_hline(yintercept = 0, alpha = 0.5, color = "darkgrey", linetype="dashed")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=1.2, y=bc_net_savings+1.6e6, label=paste0("Basecase:\n", dollar(bc_net_savings)),
size = 3.5, color="black")
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings, color="black")+
geom_hline(yintercept = 0, alpha = 0.5, color = "darkgrey", linetype="dashed")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=0.7, y=bc_net_savings+1.5e6, label=paste0(dollar(bc_net_savings)),
size = 3.5, color="black")
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings, color="black")+
geom_hline(yintercept = 0, alpha = 0.5, color = "darkgrey", linetype="dashed")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=0.75, y=bc_net_savings+1.4e6, label=paste0(dollar(bc_net_savings)),
size = 3.5, color="black")
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(data = dt_univ_plt) +
geom_segment(aes(x = name_range, xend=name_range, y = net_savings_low, yend=net_savings_high), size=6, color="grey")+
theme(legend.position = "None")+
coord_flip()+
geom_hline(yintercept = bc_net_savings, color="black")+
geom_hline(yintercept = 0, alpha = 0.5, color = "red")+
scale_alpha_manual(values = c(1, 0))+
scale_y_continuous(labels = function(x){paste0("$",x/1e6,"M")},
)+
xlab("")+
ylab("Net savings of WBPR")+
annotate("text", x=0.75, y=bc_net_savings+1.4e6, label=paste0(dollar(bc_net_savings)),
size = 3.5, color="black")
ggsave("figs/tornado.png",
width=6.5,
height = 4,
units="in")
ggplot(dt_psa_outcomes, aes(x=all_ae.DALY_reduced, y=-1*net_savings))+
geom_point(aes(color=cost_saving), alpha=0.5)+
geom_hline(yintercept=0, color="grey")+
scale_y_continuous(labels = label_dollar(), name="Net incremental healthcare cost")+
scale_x_continuous(labels = label_comma(), name="Incremental DALYs averted", limits = c(0, 160000))+
#geom_abline(slope=100)+
annotate("text",
label=paste0("WBPR was cost-saving\nin ",
percent(dt_psa_outcomes[net_savings>0, .N/nrow(dt_psa_outcomes)]),
" of iterations"),
x=120000, y = -1.2e6, color="forestgreen")+
annotate("text",
label=paste0("WBPR never cost more\nthan ",
dt_psa_outcomes[, dollar(ceiling(max(ICER)))],
" per DALY"),
x=120000, y = 1.2e6, color="dodgerblue")+
theme(legend.position = "None")+
scale_color_manual(values=c("forestgreen", "dodgerblue"))
ggsave("figs/cea_scatter.png",
width=6.5,
height = 4,
units="in")
ggplot(dt_psa_outcomes, aes(x=all_ae.DALY_reduced, y=-1*net_savings))+
geom_point(aes(color=cost_saving), alpha=0.5)+
geom_hline(yintercept=0, color="grey")+
scale_y_continuous(labels = label_dollar(), name="Net incremental healthcare cost")+
scale_x_continuous(labels = label_comma(), name="Incremental DALYs averted", limits = c(0, 160000))+
#geom_abline(slope=100)+
annotate("text",
label=paste0("WBPR was cost-saving\nin ",
percent(dt_psa_outcomes[net_savings>0, .N/nrow(dt_psa_outcomes)]),
" of iterations"),
x=120000, y = -1.8e6, color="forestgreen")+
annotate("text",
label=paste0("WBPR never cost more\nthan ",
dt_psa_outcomes[, dollar(ceiling(max(ICER)))],
" per DALY"),
x=120000, y = 1.8e6, color="dodgerblue")+
theme(legend.position = "None")+
scale_color_manual(values=c("forestgreen", "dodgerblue"))
ggsave("figs/cea_scatter.png",
width=6.5,
height = 4,
units="in")
ggplot(dt_psa_outcomes, aes(x=all_ae.DALY_reduced, y=-1*net_savings))+
geom_point(aes(color=cost_saving), alpha=0.5)+
geom_hline(yintercept=0, color="grey")+
scale_y_continuous(labels = label_dollar(), name="Net incremental healthcare cost")+
scale_x_continuous(labels = label_comma(), name="Incremental DALYs averted", limits = c(0, 160000))+
#geom_abline(slope=100)+
annotate("text",
label=paste0("WBPR was cost-saving\nin ",
percent(dt_psa_outcomes[net_savings>0, .N/nrow(dt_psa_outcomes)]),
" of iterations"),
x=120000, y = -1.3e6, color="forestgreen")+
annotate("text",
label=paste0("WBPR never cost more\nthan ",
dt_psa_outcomes[, dollar(ceiling(max(ICER)))],
" per DALY"),
x=120000, y = 1.3e6, color="dodgerblue")+
theme(legend.position = "None")+
scale_color_manual(values=c("forestgreen", "dodgerblue"))
ggsave("figs/cea_scatter.png",
width=6.5,
height = 4,
units="in")
range_sec_infections_buden_red
dt_univ[net_savings_low < 0 | net_savings_high < 0,]
dt_univ[rname=="c_PI", dollar(-1*net_savings_high, largest_with_cents = 1e+02)]
dt_univ[net_savings_low < 0 | net_savings_high < 0, .N]-2
dt_univ[nmb_low < 0 | nmb_high < 0,]
dt_univ[net_savings_low < 0 | net_savings_high < 0, .N]
range_no_sepsis_net_cost
